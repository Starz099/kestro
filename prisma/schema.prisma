generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(cuid())
  clerkId   String   @unique
  username  String   @unique
  runs      Run[]    @relation("UserRuns")
  createdAt DateTime @default(now())
}

model Run {
  id                String           @id @default(cuid())
  userId            String
  username          String
  activity          ActivityType
  language          Language
  mode              Mode
  editor            EditorMode
  timerSeconds      Int?
  wordCount         Int?
  taskCount         Int?
  snippetCount      Int?
  durationSeconds   Int?
  wpm               Float?
  rawWpm            Float?
  accuracy          Float?
  errors            Int?
  consistency       Float?
  tasksCompleted    Int?
  tasksPerMinute    Float?
  snippetsCompleted Int?
  snippetsPerMinute Float?
  codingWpm         Float?
  createdAt         DateTime         @default(now())
  user              User             @relation("UserRuns", fields: [userId], references: [id])
  runSeriesPoints   RunSeriesPoint[] @relation("RunSeriesPoints")

  @@index([activity, language, mode, editor])
  @@index([createdAt])
}

// Removed RunConfig

// Removed RunResult

model RunSeriesPoint {
  id    String @id @default(cuid())
  runId String
  run   Run    @relation("RunSeriesPoints", fields: [runId], references: [id])

  second       Int
  wpm          Float?
  rawWpm       Float?
  errors       Int?
  tasksDone    Int?
  snippetsDone Int?

  @@unique([runId, second])
}

enum ActivityType {
  TEXT
  CODE
}

enum Language {
  ENGLISH
  PYTHON
  JAVASCRIPT
  CPP
}

enum Mode {
  TIMER
  WORDS
  ZEN
  TASKS
  SNIPPETS
  FIX
}

enum EditorMode {
  TEXT
  VSCODE
  VIM
}
